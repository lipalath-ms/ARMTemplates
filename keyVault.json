{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "solutionAbbreviation": {
      "type": "string",
      "defaultValue": "gmm",
      "minLength": 2,
      "maxLength": 3,
      "metadata": {
        "description": "Enter an abbreviation for the solution."
      }
    },
    "resourceGroupClassification": {
      "type": "string",
      "defaultValue": "data",
      "allowedValues": ["prereqs", "data", "compute"],
      "metadata": {
        "description": "Classify the types of resources in this resource group."
      }
    },
    "environmentAbbreviation": {
      "type": "string",
      "minLength": 2,
      "maxLength": 4,
      "metadata": {
        "description": "Enter an abbreviation for the environment."
      }
    },
    "keyVaultSkuName": {
      "type": "string",
      "allowedValues": ["Premium", "Standard"],
      "defaultValue": "Standard"
    },
    "keyVaultSkuFamily": {
      "type": "string",
      "defaultValue": "A"
    },
    "keyVaultTenantId": {
      "type": "string"
    }
  },
  "variables": {
    "keyVault": {
      "name": "[concat(parameters('solutionAbbreviation'), '-', parameters('resourceGroupClassification'), '-', parameters('environmentAbbreviation'))]",
      "sku": {
        "name": "[parameters('keyVaultSkuName')]",
        "family": "[parameters('keyVaultSkuFamily')]"
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.KeyVault/vaults",
      "apiVersion": "2016-10-01",
      "name": "[variables('keyVault').name]",
      "location": "[resourceGroup().location]",
      "tags": {
        "Owner": "[resourceGroup().tags.Owner]",
        "Env": "[resourceGroup().tags.Env]",
        "AppId": "[resourceGroup().tags.ComponentId]"
      },
      "properties": {
        "enabledForDeployment": true,
        "enabledForTemplateDeployment": true,
        "enabledForVolumeEncryption": true,
        "sku": {
          "name": "[variables('keyVault').sku.name]",
          "family": "[variables('keyVault').sku.family]"
        },
        "tenantId": "[parameters('keyVaultTenantId')]",
        "accessPolicies": []
      }
    }
  ],
  "outputs": {}
}
